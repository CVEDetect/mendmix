(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{827:function(a,t,s){"use strict";s.r(t);var n=s(111),e=Object(n.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h3",{attrs:{id:"功能说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#功能说明"}},[a._v("#")]),a._v(" 功能说明")]),a._v(" "),s("ul",[s("li",[a._v("代码生成、自动CRUD、可无缝对接mybaits增强框架"),s("code",[a._v("Mapper")])]),a._v(" "),s("li",[a._v("基于properties配置多数据源支持，无需修改XML")]),a._v(" "),s("li",[a._v("读写分离，事务内操作强制读主库")]),a._v(" "),s("li",[a._v("基于注解自动缓存管理（所有查询方法结果自动缓存、自动更新，事务回滚缓存同步回滚机制）")]),a._v(" "),s("li",[a._v("自动缓存实现基于"),s("code",[a._v("jeesuite-cache")]),a._v("和"),s("code",[a._v("spring-data-redis")])]),a._v(" "),s("li",[a._v("分页组件")]),a._v(" "),s("li",[a._v("敏感操作保护")])]),a._v(" "),s("h3",{attrs:{id:"使用说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用说明"}},[a._v("#")]),a._v(" 使用说明")]),a._v(" "),s("h4",{attrs:{id:"添加依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加依赖"}},[a._v("#")]),a._v(" 添加依赖")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("<dependency>\n    <groupId>com.jeesuite</groupId>\n    <artifactId>jeesuite-mybatis</artifactId>\n    <version>[最新版本]</version>\n</dependency>\n")])])]),s("hr"),a._v(" "),s("h5",{attrs:{id:"其他功能说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#其他功能说明"}},[a._v("#")]),a._v(" 其他功能说明")]),a._v(" "),s("ul",[s("li",[a._v("读写分离\n"),s("ol",[s("li",[a._v("根据执行sql类型自动路由master/slave库")]),a._v(" "),s("li",[a._v("支持基于properties文件动态扩展slave节点")]),a._v(" "),s("li",[a._v("支持@Transactional强制使用master库查询")])])]),a._v(" "),s("li",[a._v("自动缓存\n"),s("ol",[s("li",[a._v("支持所有mapper自定义查询方法自动缓存管理（自动缓存、自动更新）")]),a._v(" "),s("li",[a._v("支持通过@CacheEvictCascade注解，级联缓存更新")]),a._v(" "),s("li",[a._v("支持通过EntityCacheHelper手动写入/更新缓存并自动纳入自动管理体系")]),a._v(" "),s("li",[a._v("防止缓存穿透，可配置缓存null值并自动更新")])])]),a._v(" "),s("li",[a._v("分页\n"),s("ol",[s("li",[a._v("支持通过标注或者定义page方法实现物理分页")])])])]),a._v(" "),s("h4",{attrs:{id:"配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[a._v("#")]),a._v(" 配置")]),a._v(" "),s("p",[a._v("基础配置")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("# CRUD增强（默认：default，可选:mapper3）\njeesuite.mybatis.crudDriver=default\njeesuite.mybatis.dbType=Mysql\njeesuite.mybatis.cacheEnabled=true\njeesuite.mybatis.nullValueCache=false\njeesuite.mybatis.cacheExpireSeconds=300\njeesuite.mybatis.dynamicExpire=false\njeesuite.mybatis.rwRouteEnabled=false\njeesuite.mybatis.paginationEnabled=true\n")])])]),s("p",[a._v("数据源配置")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("#mysql global config\ndb.driverClass=com.mysql.jdbc.Driver\ndb.initialSize=2\ndb.minIdle=1\ndb.maxActive=10\ndb.maxWait=60000\ndb.timeBetweenEvictionRunsMillis=60000\ndb.minEvictableIdleTimeMillis=300000\ndb.testOnBorrow=false\ndb.testOnReturn=false\n\n#master\nmaster.db.url=jdbc:mysql://localhost:3306/demo_db?seUnicode=true&amp;characterEncoding=UTF-8\nmaster.db.username=root\nmaster.db.password=123456\nmaster.db.initialSize=2\nmaster.db.minIdle=2\nmaster.db.maxActive=20\n\n#slave ....\nslave1.db.url=jdbc:mysql://localhost:3306/demo_db2?seUnicode=true&amp;characterEncoding=UTF-8\nslave1.db.username=root\nslave1.db.password=123456\n\n#slave2 ....\nslave2.db.url=jdbc:mysql://localhost:3306/demo_db3?seUnicode=true&amp;characterEncoding=UTF-8\nslave2.db.username=root\nslave2.db.password=123456\n")])])]),s("p",[a._v("说明")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("slave")]),a._v("序列从1开始")]),a._v(" "),s("li",[a._v("每个数据源的配置会覆盖全局配置")])]),a._v(" "),s("h5",{attrs:{id:"mybais模块aop"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mybais模块aop"}},[a._v("#")]),a._v(" mybais模块AOP")]),a._v(" "),s("p",[a._v("如果使用了自动cache和读写分离插件，需要通过AOP做缓存回滚，和强制使用master生效。")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("package")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("project"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("base"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("package")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("interceptor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("aspectj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("annotation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Aspect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("aspectj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("annotation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Pointcut")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("core"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Ordered")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("core"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("annotation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Order")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("stereotype"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Component")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("jeesuite"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mybatis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("spring"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MybatisPluginBaseSpringInterceptor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Aspect")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Component")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Order")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Ordered")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("HIGHEST_PRECEDENCE "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MybatisPluginSpringInterceptor")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("extends")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MybatisPluginBaseSpringInterceptor")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Override")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Pointcut")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"execution(* ${project.base.package}.service.*.*(..))"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("pointcut")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("h5",{attrs:{id:"spring配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#spring配置"}},[a._v("#")]),a._v(" spring配置")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('    \x3c!--除了datasource配置外，其他都与原生配置一样--\x3e\n    <bean id="routeDataSource" class="com.jeesuite.mybatis.datasource.MutiRouteDataSource">\n       \x3c!-- \n       如果你的数据库配置文件内容自定义了加解密规则，请自行重写ConfigReader\n       <property name="configReader">\n           <bean class="com.jeesuite.mybatis.datasource.MyConfigReader" />\n       </property>\n        --\x3e\n    </bean>\n\n\n    <bean id="routeSqlSessionFactory" class="com.jeesuite.mybatis.spring.SqlSessionFactoryBean">\n      \x3c!-- 如果包含多个数据源则需要指定groupName，默认为：default --\x3e\n      <property name="groupName" value="default" />\n    <property name="configLocation" value="classpath:mybatis-configuration.xml" />\n    <property name="mapperLocations" value="classpath:mapper/*Mapper.xml" />\n    <property name="typeAliasesPackage" value="com.jeesuite.mybatis.test.entity" />\n    <property name="dataSource" ref="routeDataSource" />\n  </bean>\n\n  <bean class="org.mybatis.spring.mapper.MapperScannerConfigurer">\n    <property name="sqlSessionFactoryBeanName" value="routeSqlSessionFactory" />\n    <property name="basePackage" value="com.jeesuite.mybatis.test.mapper" />\n  </bean>\n')])])]),s("p",[a._v("默认使用jeesuite-cache模块作为自动缓存支持，如果你需要使用"),s("code",[a._v("spring-data-redis")]),a._v("或者自定义，可以按如下配置")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('<bean id="redisTemplate" class="org.springframework.data.redis.core.RedisTemplate">\n    <property name="connectionFactory" ref="jedisConnectionFactory" />\n    ....\n</bean>\n\n<bean id="stringRedisTemplate" class="org.springframework.data.redis.core.StringRedisTemplate">\n  <property name="connectionFactory" ref="jedisConnectionFactory" />\n</bean>\n\n\x3c!-- 使用spring-data-redis作为mybatis自动缓存提供者 --\x3e\n<bean class="com.jeesuite.mybatis.plugin.cache.provider.SpringRedisProvider">\n    <property name="redisTemplate"  ref="redisTemplate"/>\n    <property name="stringRedisTemplate" ref="stringRedisTemplate" />\n</bean>\n')])])]),s("h4",{attrs:{id:"springboot集成"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#springboot集成"}},[a._v("#")]),a._v(" springboot集成")]),a._v(" "),s("h5",{attrs:{id:"添加依赖-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加依赖-2"}},[a._v("#")]),a._v(" 添加依赖")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("<dependency>\n    <groupId>com.jeesuite</groupId>\n    <artifactId>jeesuite-springboot-starter</artifactId>\n    <version>[最新版本]</version>\n</dependency>\n")])])]),s("h5",{attrs:{id:"启动注解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动注解"}},[a._v("#")]),a._v(" 启动注解")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("@EnableJeesuiteMybatis\n")])])]),s("h5",{attrs:{id:"配置说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置说明"}},[a._v("#")]),a._v(" 配置说明")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("jeesuite.mybatis.dbType=MySQL\njeesuite.mybatis.crudDriver=mapper3\njeesuite.mybatis.cacheEnabled=false\njeesuite.mybatis.rwRouteEnabled=false\njeesuite.mybatis.dbShardEnabled=false\njeesuite.mybatis.paginationEnabled=true\n")])])]),s("hr"),a._v(" "),s("p",[a._v("另外需要在自己项目加入spring-data-redis依赖")]),a._v(" "),s("h4",{attrs:{id:"如何使用自动缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何使用自动缓存"}},[a._v("#")]),a._v(" 如何使用自动缓存")]),a._v(" "),s("p",[a._v("只需要在mapper接口增加**@com.jeesuite.mybatis.plugin.cache.annotation.Cache**标注")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("interface")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("UserEntityMapper")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("extends")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("BaseMapper")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("UserEntity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Cache")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("UserEntity")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("findByMobile")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Param")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"mobile"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" mobile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Cache")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("List")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("findByType")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Param")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"type"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v("配置完成即可，查询会自动缓存、更新会自动更新。")]),a._v(" "),s("h4",{attrs:{id:"一些其他说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一些其他说明"}},[a._v("#")]),a._v(" 一些其他说明")]),a._v(" "),s("h5",{attrs:{id:"开启了自动缓存数据库事务失败写入缓存如何处理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开启了自动缓存数据库事务失败写入缓存如何处理"}},[a._v("#")]),a._v(" 开启了自动缓存数据库事务失败写入缓存如何处理？")]),a._v(" "),s("ul",[s("li",[a._v("在事务失败后调用**CacheHandler.rollbackCache(),**通常在业务的拦截器统一处理\n"),s("h5",{attrs:{id:"自动缓存的实体如何更新"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自动缓存的实体如何更新"}},[a._v("#")]),a._v(" 自动缓存的实体如何更新？")])]),a._v(" "),s("li",[a._v("首先查询出实体对象，UserEntity entity = mapper.get...(id);")]),a._v(" "),s("li",[a._v("然后通过mapper.updateSelective(entity);")])]),a._v(" "),s("p",[a._v("如果不全量更新会导致缓存的内容是有部分字段，因为update后会那最新的entity更新缓存。")]),a._v(" "),s("h5",{attrs:{id:"如果手动更新或写入实体缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如果手动更新或写入实体缓存"}},[a._v("#")]),a._v(" 如果手动更新或写入实体缓存？")]),a._v(" "),s("p",[a._v("提供EntityCacheHelper方法，在代码中手动写入缓存也将纳入自动缓存管理，无需担心缓存更新问题。")]),a._v(" "),s("p",[a._v("/**")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v(" \\* 查询并缓存结果\n\n \\* @param entityClass 实体类class \\(用户组装实际的缓存key\\)\n\n \\* @param key 缓存的key（和entityClass一起组成真实的缓存key。&lt;br&gt;如entityClass=UserEntity.class,key=findlist，实际的key为：UserEntity.findlist）\n\n \\* @param expireSeconds 过期时间，单位：秒\n\n \\* @param dataCaller 缓存不存在数据加载源\n\n \\* @return\n\n \\*/\n\npublic static &lt;T&gt; T queryTryCache\\(Class&lt;? extends BaseEntity&gt; entityClass,String key,long expireSeconds,Callable&lt;T&gt; dataCaller\\)\n")])])]),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//生成的缓存key为：UserEntity.findByStatus:2")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("EntityCacheHelper")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("queryTryCache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("UserEntity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"findByStatus:2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Callable")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("List")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("UserEntity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("List")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("UserEntity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("call")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("throws")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Exception")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//查询语句")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("List")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("UserEntity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" entitys "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" mapper"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("findByStatus")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("short")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" entitys"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("h4",{attrs:{id:"如何使用分页"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何使用分页"}},[a._v("#")]),a._v(" 如何使用分页")]),a._v(" "),s("h5",{attrs:{id:"_1-标注方式-pageable"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-标注方式-pageable"}},[a._v("#")]),a._v(" 1.标注方式("),s("code",[a._v("@Pageable")]),a._v(")")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//mapper接口")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Pageable")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("List")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("UserEntity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("findByStatus")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("short")]),a._v(" status"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//调用")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Page")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("UserEntity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" pageInfo "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" mapper"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("pageQuery")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PageParams")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("h5",{attrs:{id:"_2-page方法定义方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-page方法定义方式"}},[a._v("#")]),a._v(" 2.page方法定义方式")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//mapper接口")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Select")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"SELECT * FROM users where 1=1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Page")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("UserEntity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("pageQuery")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Param")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"pageParam"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PageParams")]),a._v(" pageParam"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//调用")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Page")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("UserEntity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" pageInfo "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PageExecutor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("pagination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PageParams")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PageDataLoader")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("UserEntity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Override")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("List")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("UserEntity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("load")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n       "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" mapper"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("findByStatus")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("short")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("@EnableJeesuiteMybatis")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("jeesuite.mybatis.dbType=MySQL\njeesuite.mybatis.crudDriver=mapper3\njeesuite.mybatis.cacheEnabled=false\njeesuite.mybatis.rwRouteEnabled=false\njeesuite.mybatis.dbShardEnabled=false\njeesuite.mybatis.paginationEnabled=true\n")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);